---
layout: post
title: How to disable the nginx TYPO3 cache set by ext:nginx_cache in development
  context
date: '2019-08-25T19:22:00.000+02:00'
author: Torben Hansen
tags:
- nginx
- disable
- cache
- development
modified_time: '2019-08-25T19:22:56.474+02:00'
thumbnail: https://1.bp.blogspot.com/-WsS2GuNrkyM/XWAktySEtEI/AAAAAAAAhNY/2DsjokFgW94GKihzfvarCMVA9WtIN2LeQCLcBGAs/s72-c/typo3-cache.png
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-1356148107491560920
blogger_orig_url: http://www.derhansen.de/2019/08/how-to-disable-typo3-nginx-fastcgi-cache-in-development.html
permalink: /2019/08/how-to-disable-typo3-nginx-fastcgi-cache-in-development.html
---

When you run TYPO3 on nginx webservers, you can use the nginx FastCGI cache to really increase the performance of your website. Basically, the nginx FastCGI cache stores pages rendered by TYPO3 in the webservers memory. So once a page is cached in the nginx FastCGI cache, it will be delivered directly from the webservers memory which is really fast.<br /><br />When using nginx FastCGI cache, the TYPO3 extension&nbsp;<a href="https://extensions.typo3.org/extension/nginx_cache/" target="_blank">nginx_cache</a> can be used to ensure that the nginx FastCGI cache is purged, when TYPO3 content changes. Also the extension ensures, that pages are removed from the cache, when the TYPO3 page lifetime expires.<br /><br />However, when you do not need the nginx FastCGI cache while <b>developing locally</b> (e.g. no cache configured or even a different webserver), the clear cache function of TYPO3 results in an error message.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-WsS2GuNrkyM/XWAktySEtEI/AAAAAAAAhNY/2DsjokFgW94GKihzfvarCMVA9WtIN2LeQCLcBGAs/s1600/typo3-cache.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="90" data-original-width="426" src="https://1.bp.blogspot.com/-WsS2GuNrkyM/XWAktySEtEI/AAAAAAAAhNY/2DsjokFgW94GKihzfvarCMVA9WtIN2LeQCLcBGAs/s1600/typo3-cache.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;">In the TYPO3 log you can find messages like shown below:</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"></div><pre><code><br />Core: Exception handler (WEB): Uncaught TYPO3 Exception: #500: Server error: `PURGE https://www.domain.tld/*` resulted in a `500 Internal Server Error`</code></pre><br />The message states, that the PURGE request to the nginx FastCGI cache failed, simply because the PURGE operation is not allowed or configured.<br /><br />Since the extension nginx_cache has no possibility to disable it functionality, you can remove it locally. But if you have the file PackageStates.php in version control, uninstalling the extension can be error prone, since one&nbsp;by accident may commit the PackageStates.php without ext:nginx_cache installed resulting in the cache to be disabled on the production system.<br /><br />In order to disable the extensions functionality locally (or in your development environment), you should add the following to the ext_localconf.php file of your sitepackage:<br /><pre><code><br />// Disable nginx cache for development context<br />if (\TYPO3\CMS\Core\Utility\GeneralUtility::getApplicationContext()-&gt;isDevelopment()) {<br />    unset($GLOBALS['TYPO3_CONF_VARS']['SYS']['caching']['cacheConfigurations']['nginx_cache']);<br />    unset($GLOBALS['TYPO3_CONF_VARS']['SC_OPTIONS']['t3lib/cache/frontend/class.t3lib_cache_frontend_variablefrontend.php']['set']['nginx_cache']);<br />    unset($GLOBALS['TYPO3_CONF_VARS']['SC_OPTIONS']['tslib/class.tslib_fe.php']['pageLoadedFromCache']['nginx_cache']);<br />}<br /></code></pre><br />This will unset the cache and all hooks set by the extension if TYPO3 runs in development context. Note, that adding the snippet to <b>AdditionalConfiguration.php will not work</b>, since the ext_localconf.php of ext:nginx_cache is processed after AdditionalConfiguration.php.<br /><br />Finally, you have to ensure, that the new code is processed after the ext_localconf.php of ext:nginx_cache is processed. In order to do so, you have must add <b>a dependency</b> to ext:nginx_cache the ext_emconf.php of your sitepackage as shown below:<br /><pre><code><br />    'constraints' =&gt; [<br />        'depends' =&gt; [<br />            'nginx_cache' =&gt; '2.1.0-9.9.99',<br />        ],<br />        'conflicts' =&gt; [],<br />    ]<br /></code></pre><br />I should be noted, that the shown technique can also be used to unset/change a lot of other settings which are made by installed extensions.