---
layout: post
title: How to migrate switchableControllerActions in a TYPO3 Extbase extension to
  single plugins
date: '2021-03-22T11:52:00.001+01:00'
author: Torben Hansen
tags:
- switchableControllerAction
- "#89463"
- TYPO3 11
- migrate
modified_time: '2021-03-22T11:57:36.184+01:00'
thumbnail: https://1.bp.blogspot.com/-LmDlVtWjpiY/YFWUdMw30pI/AAAAAAAAraA/BtCskzqYxycTUoiNbEDgtktJtl9wvARpQCLcBGAsYHQ/s72-c/Bildschirmfoto%2B2021-03-20%2Bum%2B07.21.17.png
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-4619455578044088027
blogger_orig_url: http://www.derhansen.de/2021/03/migrate-switchablecontrolleractions.html
permalink: /2021/03/migrate-switchablecontrolleractions.html
---

<p></p><div><b>TL;DR </b>- I created this <a href="https://gist.github.com/derhansen/4524495ccfef9335c96d6d535bad7324">TYPO3 update wizard</a> which migrates plugins and Extbase plugin settings for each former switchable controller actions configuration entry.</div><div><br /></div><div>Since switchableControllerActions in Extbase plugins have been&nbsp;<a href="https://docs.typo3.org/c/typo3/cms-core/master/en-us/Changelog/10.3/Deprecation-89463-SwitchableControllerActions.html">deprecated</a> in TYPO3 10.4 and will be removed in either TYPO3 11 but most likely 12, I decided to remove switchableControllerActions in my TYPO3 Extbase extensions already with the upcoming versions that will be compatible with TYPO3 11.</div><div><br /></div><div>In this blogpost I will show, how extension authors can add a smooth migration path to their existing extensions by adding an update wizard which migrates all existing plugin settings, so users do not have to change plugin settings manually.&nbsp;</div><div><br /></div><div>As a starting point lets have a look at my TYPO3 extension <a href="https://extensions.typo3.org/extension/plain_faq/">Plain FAQ</a>, which is a very simple Extbase extension with one plugin, that has 3 switchableControllerActions.</div><div><br /></div><div>Source: <a href="https://github.com/derhansen/plain_faq/blob/2.x/Configuration/FlexForms/Pi1.xml#L15">Flexform for Pi1</a></div><div><ul style="text-align: left;"><li>Faq-&gt;list;Faq-&gt;detail</li><li>Faq-&gt;list</li><li>Faq-&gt;detail</li></ul></div><div>For all 3 switchableControllerActions, I created 3 individual plugins <i>(Pilistdetail, Pilist, Pidetail)</i> which handle the action(s) of each&nbsp;switchable controller action from the list above.&nbsp;</div><div><br /></div><div>  <div></div></div><div>For each new plugin, I added an individual FlexForm file which holds the available settings for the plugin. This can be done by duplicating the old FlexForm (Pi1 in this case) and removing those settings, which are not available in the new plugin. Also display conditions based&nbsp;switchableControllerActions must be removed.</div><div><br /></div><div>Finally I created a new item group for the Plugins of the extension, so all plugins are grouped as shown on the screenshot below.</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-LmDlVtWjpiY/YFWUdMw30pI/AAAAAAAAraA/BtCskzqYxycTUoiNbEDgtktJtl9wvARpQCLcBGAsYHQ/s536/Bildschirmfoto%2B2021-03-20%2Bum%2B07.21.17.png" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="104" data-original-width="536" src="https://1.bp.blogspot.com/-LmDlVtWjpiY/YFWUdMw30pI/AAAAAAAAraA/BtCskzqYxycTUoiNbEDgtktJtl9wvARpQCLcBGAsYHQ/s16000/Bildschirmfoto%2B2021-03-20%2Bum%2B07.21.17.png" /></a></div><br /><div>This is basically all work that needs to be done on code side in order split the old plugin to the new plugins.</div><div><br /></div><h3 style="text-align: left;">Migration of existing plugins</h3><div><br /></div><div>To be able to migrate all existing plugins and settings to the new plugins, I created a custom upgrade wizard that takes care of all required tasks. Those tasks are as following:</div><ul style="text-align: left;"><li>Determine, which tt_content record need to be updated</li><li>Analyse existing Plugin (field: <i>list_type</i>) and switchableControllerActions in FlexForm (field: <i>pi_flexform</i>)</li><li>Remove non-existing settings and switchableControllerAction from FlexForm by comparing settings with new FlexForm structure of target plugin</li><li>Update tt_content record with new Plugin and FlexForm</li></ul><div>As a result, a <b><a href="https://gist.github.com/derhansen/4524495ccfef9335c96d6d535bad7324">SwitchableControllerActionsPluginUpdater</a></b> has been added to the extension. It takes care of all mentioned tasks and has a configuration array which contains required settings (<i>source plugin, target plugin and&nbsp;switchableControllerActions</i>) for the migration.</div><div> <pre><code><br />private const MIGRATION_SETTINGS = [<br />    [<br />        'sourceListType' =&gt; 'plainfaq_pi1',<br />        'switchableControllerActions' =&gt; 'Faq-&gt;list;Faq-&gt;detail',<br />        'targetListType' =&gt; 'plainfaq_pilistdetail'<br />    ],<br />    [<br />        'sourceListType' =&gt; 'plainfaq_pi1',<br />        'switchableControllerActions' =&gt; 'Faq-&gt;list',<br />        'targetListType' =&gt; 'plainfaq_pilist'<br />    ],<br />    [<br />        'sourceListType' =&gt; 'plainfaq_pi1',<br />        'switchableControllerActions' =&gt; 'Faq-&gt;detail',<br />        'targetListType' =&gt; 'plainfaq_pidetail'<br />    ],<br />];<br /></code></pre>     </div><div>So basically, one configuration entry has to be added for each switchable controller action setting of the old plugin. The wizard determines the new FlexForm settings using configured TCA, removes all non-existing settings (which is important, since TYPO3 will pass every setting available in pi_flexform to Extbase controllers and Fluid templates) and changes the "old" Plugin to the new one.</div><div><br /></div><div>The&nbsp;update wizard can possibly also be used in other Extbase extensions, since the&nbsp;MIGRATION_SETTINGS are the only configuration options that need to be changed.</div><div><br /></div><div>The required changes for the complete removal of switchableControllerActions is available in this <a href="https://github.com/derhansen/plain_faq/commit/87acf8f61133383165d5a02881b227f4de43997d">commit</a>.</div><p></p>