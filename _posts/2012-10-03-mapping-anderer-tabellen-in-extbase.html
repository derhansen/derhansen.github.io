---
layout: post
title: 'Mapping anderer Tabellen in Extbase '
date: '2012-10-03T13:24:00.000+02:00'
author: Torben Hansen
tags:
- domain
- mapping
- repository
- Extbase
- TYPO3
- storagePid
modified_time: '2012-10-03T13:25:38.486+02:00'
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-7915244325392503869
blogger_orig_url: http://www.derhansen.de/2012/10/mapping-anderer-tabellen-in-extbase.html
permalink: /2012/10/mapping-anderer-tabellen-in-extbase.html
---

Neulich stand ich vor der eigentlich recht simplen Aufgabe aus einer Extbase Extension heraus auf die erzeugten Daten einer anderen Extbase Extension zuzugreifen. Im Web gibt es auch einige Tutorials, welche beschreiben wie man dieses macht, aber fast alle zeigen, wie man auf die Tabellen <i>fe_users</i> und <i>fe_groups</i> zugreift, welche beide schon als Domain-Model bei Extbase mitgeliefert werden. Ein funktionierendes Praxisbeispiel für den Zugriff auf eigene Datenstrukturen konnte ich leider nicht finden.<br /><br />In diesem Beitrag zeige ich deshalb, wie man aus <b>einer Extbase Extension</b> heraus auf die Daten einer <b>anderen Extbase Extensions</b> zugreifen kann.<br /><br /><u>Ausgangssituation:</u><br /><br />In einer TYPO3 Installation wurden 2 Extbase Extensions (<i>testext1</i> und <i>testext2</i>) eingerichtet, welche jeweils eigene Repositories und Storagefolder haben. Die Typoscript Constants der Extensions sind wie folgt eingerichtet:<br /><pre><code><br />plugin.tx_testext1 {<br />  persistence {<br />    storagePid = 5<br />  }<br />}<br /><br />plugin.tx_testext2 {<br />  persistence {<br />    storagePid = 6<br />  }<br />}<br /></code></pre><br />Die Datensätze von <i>testext1</i> werden also im Sysordner mit der Pid 5 abgelegt und die Datensätze von <i>testext2</i> im Sysordner mit der Pid 6. In <i>testext1</i> gibt es ein Domainmodel mit dem Namen Testext1Table und in <i>testext2</i> gibt es ein Domainmodel mit dem Namen Testext2Table.<br /><br />Ziel ist es nun, aus einem <b>Controller</b> in <i>testext2</i> auf die angelegten Daten von <i>testext1</i> zuzugreifen.<br /><br /><u>Vorgehensweise:</u><br /><br />Als erstes muss in <i>testext2</i> ein <b>Domainmodel</b> angelegt werden, welches das Domainmodel von <i>textext1</i> extended. Also wird in textext2\Classes\Domain\Model\ die Datei Testext1Table.php angelegt.<br /><pre><code><br />class Tx_Testext2_Domain_Model_Testext1Table extends Tx_Testext1_Domain_Model_Testext1Table {<br /><br />}<br /></code></pre><br />Somit wurde der <i>testext2</i> schon mal das Domainmodel aus <i>testext1</i> bekannt gemacht. Damit wir auf die Daten aus <i>testext1</i> zugreifen können, wird noch ein entsprechendes <b>Repository</b> benötigt. Dieses wird in &nbsp;textext2\Classes\Domain\Repository\Testext1TableRepository.php definiert.<br /><pre><code><br />class Tx_Testext2_Domain_Repository_Testext1TableRepository extends Tx_Extbase_Persistence_Repository {<br /><br />}<br /></code></pre><br />Nun kennt die Extension <i>testext2</i>&nbsp;das Domainmodel und hat auch ein entsprechendes Repository. Das neue Repository wird in einem Controller von <i>testext2</i> per Dependency Injection implementiert.<br /><pre><code><br />/**<br /> * testext1TableRepository<br /> *<br /> * @var Tx_Testext2_Domain_Repository_Testext1TableRepository<br /> */<br />protected $testext1TableRepository;<br /><br />/**<br /> * injectTestext1TableRepository<br /> *<br /> * @param Tx_Testext2_Domain_Repository_Testext1TableRepository $testext1TableRepository<br /> * @return void<br /> */<br />public function injectTestext1TableRepositoryRepository(Tx_Testext2_Domain_Repository_Testext1TableRepository $testext1TableRepository) {<br /> $this-&gt;testext1TableRepository = $testext1TableRepository;<br />}<br /></code></pre><br />Wer an dieser Stelle jetzt schon erste Ergebnisse aus dem implementierten Repository erwartet, wird enttäuscht und bekommt beim Versuch Daten aus dem Repository abzufragen/anzuzeigen eine Exception vom Typ&nbsp;<i>Tx_Extbase_Persistence_Storage_Exception_SqlError</i>, welche besagt, dass eine Tabelle nicht existiert.<br /><br />Die Extension <i>testext2</i> weiß also anscheinend noch gar nicht, aus welcher Tabelle die Daten des neuen Repositories abgefragt werden sollen. Um dieses einzurichten, muss man im Typoscript Setup von <i>testext2</i> ein <b>Mapping einrichten</b>.<br /><pre><code><br />config.tx_extbase {<br /> persistence {<br />    classes { <br />        Tx_Testext2_Domain_Model_Testext1Table {<br />            mapping.tableName = tx_testext1_domain_model_testext1table<br />        }<br />    }<br /> }<br />}<br /></code></pre><br />An dieser Stelle ist es wichtig, dass das Mapping direkt auf den <b>Tabellennamen</b> in der Datenbank stattfindet. <br /><br />Auch jetzt erhalten wir über das neue Repository in <i>testext2</i> noch keine Daten, da die <i>testext2</i> noch nicht weiß, in welcher <b>StoragePid</b> die Datensätze von <i>testext1</i> liegen. Hierzu ergänzt man lediglich die Typoscript Constants von <i>testext2</i> wie folgt.<br /><pre><code><br />plugin.tx_testext2 {<br />  persistence {<br />    storagePid = 6,5<br />  }<br />}<br /></code></pre><br />Die StoragePid von <i>testext1</i> wurde hinter der StoragePid von <i>testext2</i> angehängt. Nun kann das neue Repository in <i>testext2</i> angesprochen und die erwarteten Daten erfolgreich zurückgeliefert werden.<br /><br /><br />