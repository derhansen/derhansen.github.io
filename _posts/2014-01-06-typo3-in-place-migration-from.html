---
layout: post
title: TYPO3 - In-Place migration from TemplaVoila to Fluidtemplate and Grid Elements
date: '2014-01-06T11:32:00.000+01:00'
author: Torben Hansen
tags:
- Fluidtemplate
- Unreferenced elements
- TemplaVoila
- Grid Elements
- TYPO3
- Migration
modified_time: '2014-01-06T11:42:36.401+01:00'
thumbnail: http://4.bp.blogspot.com/-qr4bis2WeNs/Ur1QLghJsMI/AAAAAAAAIMo/RavvI5OQ-fQ/s72-c/content-migration.png
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-3433434050218085304
blogger_orig_url: http://www.derhansen.de/2014/01/typo3-in-place-migration-from.html
permalink: /2014/01/typo3-in-place-migration-from.html
---

<br />In the past few years I have made several websites with TYPO3 4.5 LTS and <b>TemplaVoila</b>. The new LTS of TYPO3 is going to be released march 25th, 2014 and there will surely also be a version of TemplaVoila, which is compatible with <b>TYPO3 6.2 LTS</b>, but is TemplaVoila a <b>future-proof solution</b> that will be supported by the community?<br /><div><br /></div>When Tolleiv wrote in his <a href="http://blog.tolleiv.de/2013/06/templavoila-future/" target="_blank">blogpost</a>, that&nbsp;TemplaVoila wonâ€™t be actively distributed and supported any more by him, I stopped using it for new website projects and switched to <b>Fluidtemplate</b> and <b>Grid Elements</b> which both work great.<br /><br />I asked myself what to do with the TYPO3 websites I have made with TemplaVoila? Is it maybe possible to <b>migrate a TemplaVoila</b> website to <b>Fluidtemplate</b> and <b>Grid Elements</b>? Or should a website based on TemplaVoila be built up completely new from scatch if you want to switch the template engine?<br /><br /><b>Starting to test a migration</b><br /><br />I started to <b>test a migration</b> from TemplaVoila to Fluidtemplate and Grid Elements on some of my websites. Doing so, I quickly came to a point where I was <b>frustrated</b> and about to drop the migration process, because I had to do a lot of work<b> manually</b>. After I created all Fluidtemplates and Grid Elements, I had to <b>reassign the content elements</b> from TemplaVoila content columns to the backend layout Fluidtemplate <b>content columns</b>, since not all TemplaVoila columns could be automatically migrated to the corresponding content column in the backend layout. Also I had to <b>manually migrate content</b> and <b>FlexForm content</b> for all Grid Elements I created. At this point, I started to create the TYPO3 extension <b><a href="https://github.com/derhansen/sf_tv2fluidge" target="_blank">sf_tv2fluidge</a></b>, which helped me to automate some tasks in the migration process.<br /><br /><b>Removing unreferenced content elements</b><br /><br />The first thing I stumbled across in the migration process were <b>unreferenced content elements</b>. I have seen several websites, were the "Non-used elements" tab in the TemplaVoila page view contained many, many records (sometimes more than 50 elements), because users thought, that those elements have been deleted. Well, actually they are just <b>unlinked</b> and not visible, but still present on the page. So the first thing I had to do during the migration process to Fluidtemplate was to <b>remove all unreferenced elements, </b>because Fluidtemplate does not know anything abount unreferenced content. Since it is not very efficient to remove all unreferenced elements manually, I created an action for <a href="https://github.com/derhansen/sf_tv2fluidge" target="_blank">sf_tv2fluidge</a>, which <b>recursively</b> for all pages marked all unreferenced elements as deleted.<br /><br /><b>Migrating TemplaVoila mapped content to Fluidtemplate</b><br /><br />I used to create several <b>page templates</b> with different amount of <b>content columns</b> with TemplaVoila. While migrating to Fluidtemplate, I found out, that TemplaVoila mapped content elements could not always just be migrated to the corresponding <b>content column</b> of a Fluidtemplate <b>backend layout</b>. For smaller websites with just one TemplaVoila content column, the migration of all content elements was easy and I did not have to reassign the column position of the content elements, but for more complex templates with <b>multiple content columns</b> the result was mixed up and content did'nt show up in the corresponding content column of the backend layout. Also the <b>sorting </b>of the content elements was not the same as in TemplaVoila.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-qr4bis2WeNs/Ur1QLghJsMI/AAAAAAAAIMo/RavvI5OQ-fQ/s1600/content-migration.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-qr4bis2WeNs/Ur1QLghJsMI/AAAAAAAAIMo/RavvI5OQ-fQ/s400/content-migration.png" height="313" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Content migration from TemplaVoila to backend layouts with Fluidtemplate</td></tr></tbody></table><br />I therefore created a <b>content migration helper</b> in <a href="https://github.com/derhansen/sf_tv2fluidge" target="_blank">sf_tv2fluidge</a> which allows to assign <b>TemplaVoila content columns</b> to b<b>ackend layout content columns</b> and finally <b>migrate all affected content elements</b> to the target content columns and <b>keep the sorting</b> of the content elements. Also the helper sets the corresponding backend layout for the matching pages.<br /><br /><b>TemplaVoila references</b><br /><br />One nice feature of TemplaVoila is the ability to create r<b>eferences to content elements</b>. Sadly, my newly created content migration helper did not migrate referenced content, so I digged deeper into the functionality of that feature in TemplaVoila.<br /><br />When TemplaVoila creates a reference to a content object, it just <i>saves the uid</i> of the referenced content element in an <b>XML node</b>. In this XML node, also all other uids from content elements on the&nbsp;corresponding content column are saved.&nbsp;The <b>sorting</b> of records is just as the <i>uids are ordered </i>in the XML node. So the original content element remains on source the page and the reference is just&nbsp;evaluated by TemplaVoila when rendering content in frontend or displaying content elements in the backend page module.<br /><br />The traditional way of referencing content in TYPO3 is to create a <b>shortcut</b> to an content element by using the <b>"Insert record"</b> content element. This actually creates a <b>new record</b> in the tt_content table which holds the uids to the referenced content objects. Also it contains the column position and the sorting.<br /><br />So doing the content migration I had to create a <b>new shortcut</b> for each <b>TemplaVoila reference</b> and also respect the <b>sorting</b> of all content elements in the TemplaVoila content column.<br /><br /><b>Migrating TemplaVoila Flexible Content Elements to Grid Elements</b><br /><br />The last big task was releated to TemplaVoila <b>Flexible Content Elements</b>. I normally used Flexible Content Elements when I wanted to enable the site editor to add <i>dynamic content structures</i> to a page. Examples for Flexible Content Elements are elements with <b>muliple columns</b>, <b>sliders</b> or <b>accordions</b>.<br /><br />As Flexible Content Elements are part of TemplaVoila, they also need to be migrated when you want to use Fluidtemplate as your templateengine. The best approach to do this, is to use <b>Grid Elements</b>, which supports the <i>same XML structure</i> for flexforms as TemplaVoila does. So it should at least be possible to migrate the content from <b>Flexible Content Elements</b> to <b>Grid Elements</b>.<br /><br />Now you could just <i>copy the flexform structure</i> of a Flexible Content Elements to a new Grid Element and try to get things working, but this approach is really <b>not recommended</b>. Grid Elements integrates directly into the TYPO3 page module and the user can for example use drag and drop with content elements directly on Grid Elements. By just <i>copying the flexform XML</i> <i>structure</i> of your Flexible Content Element to a new Grid Element, you will <b>loose some advantages</b> of Grid Elements. So you have to look at each Flexible Content Element <b>individually</b> and choose the <b>best matching approach</b> (e.g. recreate, migrate flexform or mixed recreation/flexform migration).<br /><br />When all Grid Elements have been created, content must be migrated. Here I faced a different situation as for normal page content. On one side, a Grid Element can have <b>content columns</b>, where content elements from Flexible Content Elements should be remapped. On the other side, a Grid Element can have a <b>flexform XML structure</b>, which is used to allow the user to input content. And finally, a Grid Element can also be a <b>combination of both</b> content columns and flexform.<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-AFKYzvtxkk0/Ur1QmC-VDLI/AAAAAAAAIMs/FmFhWJicI8Y/s1600/fce-migration.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://3.bp.blogspot.com/-AFKYzvtxkk0/Ur1QmC-VDLI/AAAAAAAAIMs/FmFhWJicI8Y/s400/fce-migration.png" height="223" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Migration from Flexible Content Elements to Grid Elements</td></tr></tbody></table><br /><br />I added a <b>Flexible Content Element to Grid Elements migration helper</b> to <a href="https://github.com/derhansen/sf_tv2fluidge" target="_blank">sf_tv2fluidge</a>, which tries to respect all 3 scenarios described above, keeps care of referenced content, migrates all content and user input made through flexform and finally <b>converts </b>the Flexible Content Element in the tt_content table to a Grid Element.<br /><br /><b>Screencast of a in-place migration</b><br /><br />Well, by now this article was very theoretical and I think it is hard to show a complete site migration by screenshots, so I created a screencast which shows a complete migration process of a demosite, which I created for this article.<br /><br /><iframe allowfullscreen="" frameborder="0" height="390" src="//www.youtube.com/embed/IcSnlfB2ol4" width="640"></iframe> <b><br /></b><b><br /></b><br /><b>Conclusion</b><br /><br />As you could see in the screencast, it is possible to migrate an existing TYPO3 website made with TemplaVoila to Fluidtemplate with Grid Elements. You will of course have to do some work by creating Fluidtemplates and Grid Elements, but can benefit from <a href="https://github.com/derhansen/sf_tv2fluidge" target="_blank">sf_tv2fluidge</a> which helps you to automate several migration steps.<br /><br />I'm pretty sure, that not all websites can be migrated as smooth as shown in the screencast, since I did not test the migration of a multilingual website and also I did not test Flexible Content Elements with containers for elements.<br /><br /><b>References</b><br /><b><br /></b>1. Extension on GitHub:&nbsp;<a href="https://github.com/derhansen/sf_tv2fluidge">https://github.com/derhansen/sf_tv2fluidge</a><br />2. Extension on TER:&nbsp;<a href="http://typo3.org/extensions/repository/view/sf_tv2fluidge">http://typo3.org/extensions/repository/view/sf_tv2fluidge</a>