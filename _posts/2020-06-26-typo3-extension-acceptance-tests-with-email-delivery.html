---
layout: post
title: Testing email delivery of a TYPO3 extension with Codeception, MailHog and GitHub
  Actions
date: '2020-06-26T14:20:00.000+02:00'
author: Torben Hansen
tags:
- MailHog
- TYPO3 CMS
- GitHub Actions
- Acceptance Testing
modified_time: '2020-06-26T14:20:19.949+02:00'
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-364573512324616464
blogger_orig_url: http://www.derhansen.de/2020/06/typo3-extension-acceptance-tests-with-email-delivery.html
permalink: /2020/06/typo3-extension-acceptance-tests-with-email-delivery.html
---

<div>Some weeks ago I published my <a href="https://www.derhansen.de/2020/05/typo3-extension-testing-with-github-actions.html" target="_blank">blogpost</a> about how to create a GitHub Actions build pipeline for a TYPO3 Extension that executes Unit-, Functional- and Acceptance tests. The extension tested in that blogpost was only a simple demo extension and for me this was a preparation to finally migrate the CI pipeline for my TYPO3 extension <a href="https://extensions.typo3.org/extension/sf_event_mgt/">sf_event_mgt</a>&nbsp;to GitHub Actions.</div><div><br /></div><div>The extension comes with lots of unit and functional tests, which are automatically executed on each commit. One missing piece in the puzzle was the automatic execution of my <b>Acceptance Tests,</b> which are based on <a href="http://codeception.com/" target="_blank">Codeception</a> and additionally require&nbsp;<a href="https://github.com/mailhog/MailHog" target="_blank">MailHog</a>&nbsp;in order to test if emails are sent by the extension and if the email content is as expected.</div><div><br /></div><div>The concept of testing emails in Acceptance Tests using Codeception is really simple. You have to add the composer package <a href="https://packagist.org/packages/ericmartel/codeception-email-mailhog" target="_blank">ericmartel/codeception-email-mailhog</a> to your dev dependencies and then you are ready to test emails as shown in the abstract of one of my tests below:</div><div><br /></div><div><pre style="text-align: left;">$I-&gt;fetchEmails();<br />$I-&gt;haveUnreadEmails();<br />$I-&gt;haveNumberOfUnreadEmails(2);<br />$I-&gt;openNextUnreadEmail();<br />$I-&gt;seeInOpenedEmailSubject('New unconfirmed registration for event "Event (reg, cat1) ' . $this-&gt;lang . '"');<br />$I-&gt;seeInOpenedEmailRecipients('admin@sfeventmgt.local');<br />$I-&gt;openNextUnreadEmail();<br />$I-&gt;seeInOpenedEmailSubject('Your registration for event "Event (reg, cat1) ' . $this-&gt;lang . '"');<br />$I-&gt;seeInOpenedEmailRecipients('johndoe@sfeventmgt.local');</pre></div><div><br /></div><div>It is also possible to check the email body for various content like I do in other parts of my <a href="https://github.com/derhansen/sf_event_mgt/tree/develop/Tests/Acceptance" target="_blank">testsuite</a>.</div><div><br /></div><div>GitHub Actions supports&nbsp;<a href="https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idservices" target="_blank">docker based service containers</a>&nbsp;and MailHog is also available as docker container, so in order to execute my Acceptance testsuite I added MailHog as service container to my CI setup as shown below:</div><div><br /></div><div style="text-align: left;"><pre>jobs:<br />&nbsp; build:<br />&nbsp; &nbsp; runs-on: ubuntu-18.04<br />&nbsp; &nbsp; services:<br />&nbsp; &nbsp; &nbsp; mailhog:<br />&nbsp; &nbsp; &nbsp; &nbsp; image: mailhog/mailhog<br />&nbsp; &nbsp; &nbsp; &nbsp; ports:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 1025:1025<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8025:8025</pre></div><div style="text-align: left;"><br /></div><div style="text-align: left;">Having the MailHog container in place, the execution of the Acceptance Tests works like a charm.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Since the Acceptance Tests also cover tests of a plugin that is only accessible by logged in frontend users, the TYPO3 website for Acceptance Tests includes a special configured page with ext:felogin for this scenario. It turned out, that those tests failed on GitHub actions, since Argon2i was not available on the testing runner for whatever reasons. In order to resolve this problem, I configured the TYPO3 website to use BcryptPasswordHash instead of Argon2i which is ok for me, since strong password hashes are not really required in this scenario.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">The&nbsp;<a href="https://github.com/derhansen/sf_event_mgt/blob/develop/.github/workflows/ci.yml" target="_blank">GitHub actions YAML file</a> is currently available in the development branch of my extension.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">The CI results including a downloadable Codeception HTML report for all acceptance tests is available for each build as shown in this example:&nbsp;<a href="https://github.com/derhansen/sf_event_mgt/actions/runs/142799855">https://github.com/derhansen/sf_event_mgt/actions/runs/142799855</a></div>