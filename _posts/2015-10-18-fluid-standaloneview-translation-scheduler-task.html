---
layout: post
title: TYPO3 - Using Fluid StandaloneView to render localized templates in a scheduler
  task (part 1)
date: '2015-10-18T19:45:00.001+02:00'
author: Torben Hansen
tags:
- fluid
- f:translate
- scheduler task
- TYPO3
modified_time: '2015-11-15T19:48:05.450+01:00'
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-804740165641750256
blogger_orig_url: http://www.derhansen.de/2015/10/fluid-standaloneview-translation-scheduler-task.html
permalink: /2015/10/fluid-standaloneview-translation-scheduler-task.html
---

tl;dr: If you want to use Fluid StandaloneView to render a template in a given language from the <b><i>backend context</i></b> (e.g. scheduler task), make sure you set the language in&nbsp;<b>$GLOBALS['BE_USER']-&gt;uc['lang']</b><br /><br />If you want to <b>switch the language several times in one request</b>, please read on in <a href="http://www.derhansen.de/2015/11/typo3-using-fluid-standaloneview-to.html" target="_blank">part 2</a> of this blogpost.<br /><br /><b>Problem description</b><br /><br />For my Event Management TYPO3 Extension I am developing a feature, where I need to send out <b>localized e-mails</b>&nbsp;to users. The e-mail content is created using a <b>Fluid StandanloneView</b>&nbsp;in a TYPO3&nbsp;<b>scheduler task</b>. Actually, this doesn't work out of the box.<br /><div><br /></div><div>In TYPO3 you can use <b>Fluid StandaloneView</b> to render HTML based content, which e.g. can be added to body field of an HTML e-mail. The TYPO3 Wiki contains some <a href="https://wiki.typo3.org/How_to_use_the_Fluid_Standalone_view_to_render_template_based_emails" target="_blank">code snippets</a> on how this can be processed. If you use the provided code snippets in your ExtBase extension, it works fine for <b>localized content</b> as long as you use it in the <b><i>frontend context</i></b> of TYPO3 (e.g. website user requests an action).&nbsp;</div><br />When you use Fluid StandaloneView from the <b><i>backend context</i></b> to generate localized content, the output differs from what you would expect. When you are logged in as a TYPO3 backend user, then the localized content is rendered with the language the <b>backend user</b> has chosen in the <b>user setup</b>. In addition, if you render a Fluid StandaloneView from a <b>commandController</b>, then the language is <b>ignored completely</b>.<br /><br /><b>Solution</b><br /><br />After digging into the problem, I found a simple way to control the language which is used during the rendering process of the Fluid StandaloneView. For the backend context, you just need to set a language (ISO2 code, lowercase) in the&nbsp;<b>$GLOBALS['BE_USER']-&gt;uc['lang']</b>&nbsp;setting. Below follows a code example which shows how this is done (see line 12).<br /><br /><script src="https://gist.github.com/derhansen/462dc7766293e82b17df.js"></script> <br /><br />Note, that you also have to make sure, that the Fluid StandaloneView knows, from which extension the localizations get loaded. This is set in line 24.<br /><br />The shown method works in both <b>TYPO3 6.2</b> and the <b>current TYPO3 master</b>. I provided a little <a href="https://github.com/derhansen/standaloneview/releases/tag/0.1.0" target="_blank">demo extension</a>, which I used for testing purposes. It contains a backend module and a command controller which renders a Fluid StandaloneView with a given language.<br /><br /><b>Technical background</b><br /><br />The <b>f:translate viewHelper</b> uses the TYPO3&nbsp;LocalizationUtility to render localized content. For the frontend context, all labels are translated depending on the language set in&nbsp;<b>$GLOBALS['TSFE']-&gt;config['config']['language']</b>. For the backend context, the language set in&nbsp;<b>$GLOBALS['BE_USER']-&gt;uc['lang'] </b>is used.