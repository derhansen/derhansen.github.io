---
layout: post
title: Setting up Jenkins CI, Selenium grid and PHPUnit Selenium to perform integration
  testing
date: '2013-03-16T09:49:00.000+01:00'
author: Torben Hansen
tags:
- Selenium
- Integration tests
- PHPUnit Selenium
- Selenium Grid
- Jenkins CI
modified_time: '2013-03-17T11:40:38.599+01:00'
thumbnail: http://3.bp.blogspot.com/-biRC46OZtZI/UUB-Yx7VVyI/AAAAAAAAElk/_2AcdMqs6Ps/s72-c/selenium-1.jpg
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-4971563606788707688
blogger_orig_url: http://www.derhansen.de/2013/03/setting-up-jenkins-ci-selenium-grid-and.html
permalink: /2013/03/setting-up-jenkins-ci-selenium-grid-and.html
---

When developing bigger TYPO3 websites with a lot of own extensions and complex functionality, it is nescessary to make sure, that the integration of new features or changes to existing code does not break the functionality of the website.<br /><br />To meet those requirements, it is recommended to use a <b>continuous integration platform</b> (like Jenkins CI) to automate the testing of the software. The platform can be used to automatically run the unit tests of your TYPO3 ExtBase extensions. If you use the <b>testing framework</b> included in the TYPO3 extension "phpunit", the tests can also help you testing your code with real data from the database.<br /><br />Another thing you can (and should) test is the website and it's functionality itself. To do so, you can use a <b>browser automation tool</b> to run automated tests against real browsers. One tool available is the <b>Selenium Server</b>.<br /><br />In this article I will show you how to build up a continuous integration solution consiting of <b>Jenkins CI</b>, <b>Selenium Grid</b> and <b>3 nodes</b> with different webbrowsers and operating systems. Finally I will show you how to create some simple selenium tests with <b>PHPUnit selenium</b> and show, how to automatically run them against different environment configurations. Please note, that I will not go into deep details installing and configuring each software.<br /><br /><h3>Setting up Jenkins CI and Selenium Grid</h3>First of all, you need to install Jenkins CI on a server. For this article, a fresh Debian Server has been installed with all dependencies for Jenkins CI and finally, the latest release of Jenkins CI has been downloaded from the Jenkins CI&nbsp;<a href="http://jenkins-ci.org/" target="_blank">homepage</a>. Installation and configuration is really simple as described <a href="https://wiki.jenkins-ci.org/display/JENKINS/Meet+Jenkins" target="_blank">here</a>. After installation and configuration, Jenkins CI is ready for use. To run PHPUnit tests, make sure you have installed PHPUnit, PHPUnit Selenium and all necessary extensions you need to run your tests.<br /><br />The next step is to install and configure Selenium on the Jenkins CI server. This instance of Selenium will run <b>Selenium Grid</b>, which will act as the master Selenium grid hub, where all other Selenium nodes connect to. Open the Jenkins Plugin manager and install the <a href="https://wiki.jenkins-ci.org/display/JENKINS/Selenium+Plugin" target="_blank">Selenium plugin</a>. Installation is really easy and you just have to install the plugin and restart your Jenkins CI. In the Jenkins CI web interface you now have the new menu "Selenium grid" as shown on the screenshot below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-biRC46OZtZI/UUB-Yx7VVyI/AAAAAAAAElk/_2AcdMqs6Ps/s1600/selenium-1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="247" src="http://3.bp.blogspot.com/-biRC46OZtZI/UUB-Yx7VVyI/AAAAAAAAElk/_2AcdMqs6Ps/s400/selenium-1.jpg" width="400" /></a></div><br />Selenium Grid is ready to handle nodes. Now it is time to configure the Selenium nodes.<br /><br /><h3>Configuring the Selenium nodes</h3>For this article, 3 virtual machines with different browser configurations have been created and configured.<br /><br /><ul><li><b>Windows XP 32 bit with the following webbrowsers</b></li><ul><li>Internet Explorer 8</li><li>Firefox 19</li><li>Opera 12</li><li>Chrome 25</li></ul><li><b>Windows 7 32 bit with the following webbrowsers</b></li><ul><li>Internet Explorer 9</li><li>Firefox 19</li><li>Opera 12</li><li>Chrome 25</li></ul><li><b>Ubuntu 12.10 64 bit with the following webbrowsers</b></li><ul><li>Firefox 19</li><li>Chrome 25</li></ul></ul><br />For all virtual machines, JAVA and the browsers listed above has been installed. Chrome, Opera and Internet Explorer requires drivers, so the locally installed Selenium Server can remote control the local webbrowser. Those drivers can be downloaded <a href="https://code.google.com/p/selenium/downloads/list" target="_blank">here</a>&nbsp;or directly via the Selenium <a href="http://docs.seleniumhq.org/download/" target="_blank">homepage</a>. Finally, the latest release of &nbsp;Selenium has been downloaded to the machines.<br /><br />For all nodes, the following command has been used to start Selenium.<br /><br /><pre></pre>java -jar \path\to\selenium-server-standalone-2.29.0.jar -role node -hub http://jenkins-server:4444/grid/register -browser "browserName=internet explorer,version=8,maxInstances=1" -browser "browserName=firefox,version=19,maxInstances=5" -browser "browserName=opera,version=12,maxInstances=5" -browser "browserName=chrome,version=25,maxInstances=5"   <br /><br />The node connects to the master Selenium hub and registers the local browsers to the hub. Note, that the parameter "-browser" <b>does not accept spaces</b> in between the individual arguments.<br /><br />After all nodes have been configured and the local Selenium Server has been started, the Selenium Grid plugin in Jenkins CI should show all registered nodes as shown on the screenshot below.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-tgdDV7Jvz68/UUCUAL7OqKI/AAAAAAAAEl0/bBJs0oggaJU/s1600/selenium-2.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://3.bp.blogspot.com/-tgdDV7Jvz68/UUCUAL7OqKI/AAAAAAAAEl0/bBJs0oggaJU/s400/selenium-2.jpg" width="346" /></a></div><br />The Selenium Grid and all nodes are now ready for usage.<br /><br /><h3>The first Selenium tests</h3>Now you are ready to write the first test. Create a new PHP file (selenium-tests.php) and include the following contents.<br /><pre><code><br />&lt;?php<br />class DefaultTest extends PHPUnit_Extensions_Selenium2TestCase {<br /><br />    /*<br />     * Setup<br />     */<br />    protected function setUp() {<br />        $this-&gt;setHost('your-jenkins');<br />        $this-&gt;setBrowser('internet explorer');<br />        $this-&gt;setBrowserUrl('http://www.google.com');<br />    }<br /><br />    /**<br />     * @test<br />     */<br />    public function testTitle() {<br />        $this-&gt;url('http://www.google.com');<br />        $this-&gt;assertEquals('Google', $this-&gt;title());<br />    }<br />}<br />?&gt;<br /></code></pre><br />Use the setHost() method to set the hostname of your jenkins. This can be an IP-Address or a hostname. Do not include any ports - PHPUnit Seleniums does this for you.<br /><br />Before setting up a job in jenkins (which I do not show in this article), you can run the test locally by using the following command.<br /><pre><code><br />phpunit selenium-tests.php<br /></code></pre><br />Now the test is sent to the Selenium Grid server and executed an a node matching the desired browser.<br /><br />The result should look like shown below<br /><pre><code><br />PHPUnit 3.7.13 by Sebastian Bergmann.<br /><br />.<br /><br />Time: 6 seconds, Memory: 6.00Mb<br /><br />OK (1 test, 1 assertion)<br /><br /></code></pre>Now we want to execute the test on a node with Internet Explorer version 8. To do so, we need to set the desired capabilities of the test. Modify the file selenium-tests.php to the following:<br /><pre><code><br />&lt;?php<br />class DefaultTest extends PHPUnit_Extensions_Selenium2TestCase {<br /><br />    /*<br />     * Setup<br />     */<br />    protected function setUp() {<br />        $this-&gt;setHost('your-jenkins');<br />        $this-&gt;setDesiredCapabilities( array('version' =&gt; '8') );<br />        $this-&gt;setBrowser('internet explorer');<br />        $this-&gt;setBrowserUrl('http://www.google.com');<br />    }<br /><br />    /**<br />     * @test<br />     */<br />    public function testTitle() {<br />        $this-&gt;url('http://www.google.com');<br />        $this-&gt;assertEquals('Google', $this-&gt;title());<br />    }<br />}<br />?&gt;<br /></code></pre><br />Now run the test again and you should see on the Windows XP machine, that Internet Explorer 8 is launched and the URL www.google.com is opened.<br /><br />That's all. You can modify the desired capabilities to suit the needs of your tests. Since the parameter accepts an array, you can also set the browser version and the target platform together.<br /><br />The last step is to check in your tests to a repository (e.g. GIT) and setup a new job in Jenkins to execute the selenium tests periodically.<br /><br />