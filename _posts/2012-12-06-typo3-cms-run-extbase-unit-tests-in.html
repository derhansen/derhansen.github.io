---
layout: post
title: TYPO3 CMS - Run Extbase unit tests in PHPStorm
date: '2012-12-06T15:25:00.000+01:00'
author: Torben Hansen
tags:
- PhpStorm
- TYPO3 CMS
- phpunit
- Extbase
- Unit Tests
modified_time: '2014-11-02T19:15:20.380+01:00'
thumbnail: http://3.bp.blogspot.com/-Fru1NrRFkGM/UMCMYl1JhZI/AAAAAAAACMU/TvPSzdGfNBs/s72-c/php-interpreter.jpg
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-3080615963553543392
blogger_orig_url: http://www.derhansen.de/2012/12/typo3-cms-run-extbase-unit-tests-in.html
permalink: /2012/12/typo3-cms-run-extbase-unit-tests-in.html
---

<b>Update 27.06.2014</b><br /><b><br /></b>With TYPO3 6.2 unit- and functional test execution is possible directly through <a href="http://www.derhansen.de/2014/06/standalone-unit-and-functional-tests.html" target="_blank">phpunit on command line</a>. So keep in mind, that the steps described below are <b>obsolete</b>, if you use TYPO3 6.2.<br /><br /><b>Original Article</b><br /><b><br /></b><b>TYPO3 CMS</b> is great and since <b>Extbase </b>it is easy to create unit tests for your code. Just create your extension with the extension_builder (or manually), install the extension phpunit from TER, add some tests to your extension and now you´re fine to run your unit tests in the phpunit TYPO3 backend module.<br /><br />If you want to run your tests directly in an IDE (in this article it´s PhpStorm), there are some things to keep care of, before the IDE is ready to run the tests. This article describes how to configure PhpStorm to run Extbase unit tests directly in the IDE and also shows some common error messages including a possible solution.<br /><br /><b>Prerequisites:</b><br /><ul><li>A working TYPO3 installation with at least one page and a TS template</li><li>An Extbase extension with at least one test</li><li>TYPO3 extension "phpunit" installed&nbsp;</li><li>The Extbase unit tests must run in TYPO3´s backend module "phpunit"</li></ul><b>Setup:</b><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-4r3hYv11z5s/UMCR-GQvvBI/AAAAAAAACM8/2H1WoH1eFXE/s1600/tests.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><br /></a></div><ol><li>Configure the PHP interpreter and set the PHP home path to:<br /><br />/path-to-typo3-site/typo3conf/ext/phpunit/Ressources/Private/Scripts</li><br /><div class="separator" style="clear: both; text-align: left;"><a href="http://3.bp.blogspot.com/-Fru1NrRFkGM/UMCMYl1JhZI/AAAAAAAACMU/TvPSzdGfNBs/s1600/php-interpreter.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-Fru1NrRFkGM/UMCMYl1JhZI/AAAAAAAACMU/TvPSzdGfNBs/s400/php-interpreter.jpg" height="128" width="400" /></a></div><br /><li>Edit your PhpStorm project to use the new PHP interpreter<br /><br /><a href="http://3.bp.blogspot.com/-dYyMQXsC5sQ/UMCNkgoyUaI/AAAAAAAACMc/wnlY7_fhp1k/s1600/interpreter-settings.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://3.bp.blogspot.com/-dYyMQXsC5sQ/UMCNkgoyUaI/AAAAAAAACMc/wnlY7_fhp1k/s400/interpreter-settings.jpg" height="71" width="400" /></a></li><li>Adjust the PHP interpreter script.<br /><br />The script which comes with the TYPO3 extension "phpunit" seems to contain an error in the CLI path. Adjust this path, so it uses <i>php_ide_testrunner</i> instead of <i>php_ide </i>as the cliKey<br /><br /><pre>CLI_PATH="${TYPO3_SITE_PATH}/typo3/cli_dispatch.phpsh phpunit_ide_testrunner"<br /></pre></li><li>Configure an environment variable in your PhpStorm project<br /><br />Edit the test configuration for the folder "Tests" of your Extbase extension and set the environment variable ENV_TYPO3_SITE_PATH to the path of your website root<br /><br /><a href="http://1.bp.blogspot.com/-DkVw4oUAsEU/UMCQsBvJ4xI/AAAAAAAACMs/jBfxE3drpnY/s1600/env.jpg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://1.bp.blogspot.com/-DkVw4oUAsEU/UMCQsBvJ4xI/AAAAAAAACMs/jBfxE3drpnY/s400/env.jpg" height="152" width="400" /></a></li><li>Create a new TYPO3 Backend user named&nbsp;<i>_cli_phpunit</i></li><li>Configure include paths<br /><br />Add the TYPO3 source and the TYPO3 extension phpunit to your PhpStorm projects include paths<br /><br /><a href="http://3.bp.blogspot.com/-pHKyqioGZK8/UMCRfCBRBkI/AAAAAAAACM0/PSMOpM9Rios/s1600/include.jpg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://3.bp.blogspot.com/-pHKyqioGZK8/UMCRfCBRBkI/AAAAAAAACM0/PSMOpM9Rios/s400/include.jpg" height="91" width="400" /></a><br /><br />This step is optional, but I think it is always nice to have code completion working when coding TYPO3 extensions.</li><li>Now you should be ready to run your Extbase unit tests directly in PhpStorm<br /><br /><a href="http://4.bp.blogspot.com/-4r3hYv11z5s/UMCR-GQvvBI/AAAAAAAACM8/2H1WoH1eFXE/s1600/tests.jpg" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-right: 1em; text-align: center;"><img border="0" src="http://4.bp.blogspot.com/-4r3hYv11z5s/UMCR-GQvvBI/AAAAAAAACM8/2H1WoH1eFXE/s400/tests.jpg" height="45" width="400" /></a></li></ol><br /><br /><br /><b>TYPO3 6.0 issues</b><br /><br />TYPO3 6.0 comes with a new base test class, which actually is´nt recognised by the TYPO3 Extension "phpunit" in TER (version 3.6.11). The problem has already been fixed, but it is not published yet, so you have to get the changes manually and pull a new version of the extension from the GIT repository at&nbsp;git://git.typo3.org/TYPO3v4/Extensions/phpunit.git<br /><br /><br /><b>Error messages and possible solutions</b><br /><br />While working with TYPO3, Extbase, phpunit and PhpStorm, I stumbled across some situations, where the tests were not running because of some misconfigured settings. Below are 2 possible situations with an error message an a description how I fixed them.<br /><br /><b>Situation 1</b><br /><b><br /></b>If you face the error message <b>"Unable to attach test reporter to test framework or test framework quit unexpectedly"</b>, this may indicate, that something is wrong with your local permissions.<br /><br /><u>Solution 1 - Wrong permissions</u><br /><br />I am developing on an Ubuntu 12.04 desktop and apache2 and TYPO3 is installed locally. I have my own user to start the desktop, so my user does not have necessary permissions to access the files owned by the webserver.<br /><br />First, you should add your local user to the group "www-data" (or the group running your local webserver). Next, you should check the TYPO3 install tool for the following:<br /><br />[fileCreateMask] = 664<br />[FolderCreateMask] = 775<br /><br />This is needed, so you local user can read/write to typo3temp.&nbsp;Finally delete the typo3temp/ folder, so the folder is recreated with the new file- and folder permissions.<br /><br /><u>Solution 2 - Trailing slash in&nbsp;ENV_TYPO3_SITE_PATH</u><br /><br />This error message can also orrur, if the&nbsp;ENV_TYPO3_SITE_PATH contains a trailing slash. So check if the path is correct.<br /><br /><b>Situation 2</b><br /><br />Once I also came across this error message "<b>PHP Fatal error: &nbsp;Cannot redeclare phpunit_autoload() (previously declared in /some/path/script.php)</b>".<br /><br />The solution for this problem was, that the cliKey in the php interpreter script was set to "phpunit" instead of "phpunit_ide_testrunner"<br /><div><br /></div><br />