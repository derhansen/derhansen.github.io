---
layout: post
title: Zugriff auf Frontend User Tabelle aus Extbase
date: '2012-06-03T16:08:00.000+02:00'
author: Torben Hansen
tags:
- fe_users
- Extbase
- TYPO3
modified_time: '2012-06-03T16:13:02.710+02:00'
thumbnail: http://2.bp.blogspot.com/-PKV-5yJouDU/T8tsQ9sFDEI/AAAAAAAAAic/_CR75BdOuck/s72-c/fe-users.png
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-3769331224358478102
blogger_orig_url: http://www.derhansen.de/2012/06/zugriff-auf-frontend-user-tabelle-aus.html
permalink: /2012/06/zugriff-auf-frontend-user-tabelle-aus.html
---

Extbase bindet die TYPO3 fe_users Tabelle schon automatisch mit ein und stellt entsprechende Objekte bereit. Man muss jedoch ein paar Dinge beachten, damit man auch auf diese Daten zugreifen kann.<br /><br />Als erstes muss man in seiner Klasse das Users-Repository per Dependency Injection zu Verfügung stellen.<br /><pre><code><br />/**<br /> * @var Tx_Extbase_Domain_Repository_FrontendUserRepository<br /> */<br />protected $userRepository;    <br /><br />/**<br /> * Inject the user repository<br /> *<br /> * @param Tx_Extbase_Domain_Repository_FrontendUserRepository $userRepository<br /> * @return void<br /> */<br />public function injectFrontendUserRepository(Tx_Extbase_Domain_Repository_FrontendUserRepository $userRepository) {<br />    $this-&gt;userRepository = $userRepository;<br />}  <br /></code></pre><br />Somit hat man dann Zugriff auf das Repository. Kennt man nun z.B. die UID des FE Users, kann man wie folgt die Userdaten über das Repository auslesen.<br /><pre><code><br />$user = $this-&gt;userRepository-&gt;findByUid($uid);<br /></code></pre><br />Wer sich nun wundert, warum die <b>Variable $user leer ist</b>, obwohl sie einen User enthalten müsste, der muss folgendes beachten.<br /><br />Extbase stellt die Daten zwar per default zur Verfügung, geht aber davon aus, dass alle FE User auch einen&nbsp;Record Type&nbsp;zugewiesen haben.<br /><pre><code><br />config.tx_extbase.persistence.classes {<br /> Tx_Extbase_Domain_Model_FrontendUser {<br />  mapping.recordType = Tx_Extbase_Domain_Model_FrontendUser<br /> }<br />}<br /></code></pre><br />Beim installieren von Extbase wird sowohl die Tabelle fe_users als auch fe_groups um genau dieses Feld (tx_extbase_type) erweitert. Existierende als auch neue User haben natürlich keinen recordType zugewiesen (siehe Bild), sodass das UserRepository demzufolge auch nichts zurückliefern kann.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-PKV-5yJouDU/T8tsQ9sFDEI/AAAAAAAAAic/_CR75BdOuck/s1600/fe-users.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="71" src="http://2.bp.blogspot.com/-PKV-5yJouDU/T8tsQ9sFDEI/AAAAAAAAAic/_CR75BdOuck/s320/fe-users.png" width="320" /></a></div><br /><br /><br /><br /><br /><br />Nun gibt es zwei Möglichkeiten mit diesem "Problem" umzugehen. Entweder man setzt in allen FE Usern den Record Type, oder man hebt das von Extbase vorgegebene mapping wie folgt auf. <br /><pre><code><br />config.tx_extbase.persistence.classes {<br /> Tx_Extbase_Domain_Model_FrontendUser {<br />  mapping.recordType &gt;<br /> }<br />}<br /></code></pre><br />Ich würde aber ganz klar dazu raten, die User entsprechend richtig anzulegen (sprich das Feld Record Type gleich bei Anlage des/der FE User zu setzen). Damit man das nicht manuell machen muss, kann man die Felder schon vorbelegen. Dazu einfach folgendes TS ins PageTS der Root-Seite einfügen.<br /><pre><code><br />TCAdefaults.fe_users.tx_extbase_type = Tx_Extbase_Domain_Model_FrontendUser<br />TCAdefaults.fe_groups.tx_extbase_type = Tx_Extbase_Domain_Model_FrontendUserGroup<br /></code></pre><br />So kann man übrigens auch beliebige Felder bei Neuanlage von Datensätzen vorbelegen.