---
layout: post
title: ExtBase - DateTime fields, validation and the DateTimeConverter
date: '2016-01-31T19:54:00.000+01:00'
author: Torben Hansen
tags:
modified_time: '2016-01-31T19:54:38.427+01:00'
blogger_id: tag:blogger.com,1999:blog-6517038209122183182.post-2756168886198337022
---

When you work on an ExtBase extension that has one or multiple date fields a user can fill out in the frontend, you may have seen this message when you submit your form:<br /><b><br /></b><i><b>The date was not recognized (for format "Y-m-d\TH:i:sP").</b></i><br /><i><br /></i>The message occurs, when you for example enter the string "01.01.2016" in a date field of a form and submit it to the server. The <b>TYPO3 property mapper</b> receives the incoming request and maps all fields of the received object to the&nbsp;appropriate <b>datatype</b>, so finally an object with the correct properties can be created. So if your domain model for example contains a property called "date1" with the datatype DateTime, the TYPO3 property mapper automatically tries to convert the given input for this field to the appropriate datatype. For fields with the datatype DateTime, the&nbsp;TYPO3&nbsp;<a href="https://typo3.org/api/typo3cms/class_t_y_p_o3_1_1_c_m_s_1_1_extbase_1_1_property_1_1_type_converter_1_1_date_time_converter.html" target="_blank">DateTimeConverter</a>&nbsp;automatically tries to apply a default date format, which is \DateTime::W3C. So this is the reason, why the message shown above may appear.<br /><br />You can set the date format to a format of you choice by using the initialize*Action in a controller as shown below.<br /><br /><script src="https://gist.github.com/derhansen/d60ff75c1e167dc2a6a0.js"></script> Doing so, you are now able to enter a date string (e.g. "01.01.2016") to a form field, and the TYPO3 DateTimeConverter will convert the given string to a valid DateTime object. Technically, the DateTimeConverter uses&nbsp;<b>\DateTime::createFromFormat($dateFormat, $dateAsString);</b> to create the DateTime object.<br /><br />However, you may experience some unexpected behavior from the DateTimeConverter when the given string does not match the format set for the DateTimeConverter.<br /><br />Let us assume, a DateTimeConverter is configured with the format shown in the example above. Passing the string "01.01.2016" will result in a DateTime object like shown below (may depend on you local timezone settings).<br /><br /><script src="https://gist.github.com/derhansen/72bd3e56b2c7e2c27144.js"></script> Until now, everything is fine, as the given format matches the one from the DateTimeConverter. Now I'll submit the form with the string "01.01.16" for the date field. The resulting DateTime object is the as shown below: <br /><script src="https://gist.github.com/derhansen/3ae48c60fab4cecb9875.js"></script> <br />Actually, the conversion to a DateTime object works fine, but the logical result may not be as expected. You can also set the string to "1.1.1", which results in the following DateTime object.<br /><br /><script src="https://gist.github.com/derhansen/8f7e6d9c8bb01aa1f404.js"></script> So the <b>first thing to keep in mind</b> is, that the DateTimeConverter will try to convert <b>any given string </b>to the configured format and will return an ExtBase validation error, if the string can not be converted to a valid DateTime object for the configured format. The DateTimeConverter will <b>not do any kind of date format validation</b>.<br /><br /><b>How to avoid problems with unexpected DateTime conversions?</b><br /><br />When you have configured the DateTimeConverter to a date format of your choice, you could validate the date format that will be submitted by using client side validation. Or even better, you could use a nice <b>Javascript datepicker plugin</b>, which makes it easy for the user to select a date and which makes sure, that the date submitted will be in the expected format.<br /><br /><i><b>Todo: Describe Server Side Date validation with the extended DateTimeConverter</b></i><br /><i><b>Todo: Describe Priority and that this affects TYPO3 globally!</b></i><br /><br /><b>What if the date does not get saved to the database?</b><br /><br />You may experience, that a date does not get saved to the database (e.g. field value is zero). If this happens, you should check, if the SQL for you date field in ext_tables.sql is as following:<br /><br /><b>date1 int(11) DEFAULT '0' NOT NULL</b><br /><br />If this is so, TYPO3 can only save dates to a database field between Fri, 13 Dec 1901 20:45:54 GMT and Tue, 19 Jan 2038 03:14:07 GMT. The reason for this is the maximum value for a signed 32 bit integer value. You can read more about this on the&nbsp;<a href="https://en.wikipedia.org/wiki/Year_2038_problem" target="_blank">year 2038 problem</a>&nbsp;wikipedia page.<br /><br />If you need to save dates before or after the min/max dates of the unix time epoch, make sure you save the date as a MySQL datetime object. Your ext_tables.sql for a date field must be configured as shown below:<br /><br /><b>date2 datetime DEFAULT '0000-00-00 00:00:00'</b><br /><b><br /></b><b><br /></b>